<?xml version="1.0"?>
<mavlink>
    <include>message_definitions/common.xml</include>
    <version>3</version>
    <enums>
        <!-- Motor Control Mode Enum -->
        <enum name="MOTOR_CONTROL_MODE">
            <description>Motor control modes for RoboMaster motor controllers</description>
            <entry value="0" name="MOTOR_CONTROL_MODE_OPEN_LOOP">
                <description>Open loop PWM control</description>
            </entry>
            <entry value="1" name="MOTOR_CONTROL_MODE_SPEED">
                <description>Closed loop speed control</description>
            </entry>
            <entry value="2" name="MOTOR_CONTROL_MODE_POSITION">
                <description>Closed loop position control</description>
            </entry>
            <entry value="3" name="MOTOR_CONTROL_MODE_DISABLED">
                <description>Motor disabled</description>
            </entry>
            <entry value="4" name="MOTOR_CONTROL_MODE_DUTY_TO_POSITION">
                <description>Apply duty cycle until target position is reached</description>
            </entry>
        </enum>
    </enums>
    <messages>
        <!-- Motor Control Command Message -->
        <message id="12000" name="ROBOMASTER_MOTOR_CONTROL">
            <description>Control command for RoboMaster motor with duty-to-position capability</description>
            <field type="uint8_t" name="target_system">System ID</field>
            <field type="uint8_t" name="target_component">Component ID</field>
            <field type="uint8_t" name="motor_id">Motor ID (1-255)</field>
            <field type="uint8_t" name="control_mode">Control mode (see MOTOR_CONTROL_MODE enum)</field>
            <field type="float" name="duty_cycle">Duty cycle (-1.0 to 1.0), used in DUTY_TO_POSITION mode</field>
            <field type="float" name="target_position_rad">Target position in radians</field>
            <field type="float" name="target_speed_rad_s">Target speed in rad/s</field>
            <field type="uint32_t" name="timeout_ms">Timeout in milliseconds for DUTY_TO_POSITION mode</field>
        </message>

        <!-- Motor Status Message -->
        <message id="12001" name="ROBOMASTER_MOTOR_STATUS">
            <description>Status feedback from RoboMaster motor controller</description>
            <field type="uint8_t" name="motor_id">Motor ID (1-255)</field>
            <field type="uint8_t" name="control_mode">Current control mode (see MOTOR_CONTROL_MODE enum)</field>
            <field type="uint8_t" name="status">Motor status (0=OK, 1=ERROR, 2=TIMEOUT, 3=NOT_INITIALIZED)</field>
            <field type="float" name="current_position_rad">Current position in radians</field>
            <field type="float" name="current_speed_rad_s">Current speed in rad/s</field>
            <field type="float" name="current_duty_cycle">Current duty cycle (-1.0 to 1.0)</field>
            <field type="float" name="position_error_rad">Position error in radians (target - current)</field>
            <field type="uint32_t" name="timestamp_ms">Timestamp in milliseconds</field>
        </message>

        <!-- DC Motor Control Command Message -->
        <message id="12002" name="DC_MOTOR_CONTROL">
            <description>Control command for DC motor with encoder feedback</description>
            <field type="uint8_t" name="target_system">System ID</field>
            <field type="uint8_t" name="target_component">Component ID</field>
            <field type="uint8_t" name="motor_id">Motor ID (1-255)</field>
            <field type="uint8_t" name="control_mode">Control mode (0=PWM/Open Loop, 1=Speed Control, 2=Position Control, 3=Disabled)</field>
            <field type="float" name="target_value">Target value (PWM duty -1.0 to 1.0, speed in rad/s, or position in rad)</field>
            <field type="float" name="speed_limit_rad_s">Speed limit in rad/s (0 = use motor default limit)</field>
            <field type="float" name="acceleration_limit_rad_s2">Acceleration limit in rad/s^2 (0 = use motor default limit)</field>
        </message>

        <!-- DC Motor Status Message -->
        <message id="12003" name="DC_MOTOR_STATUS">
            <description>Status feedback from DC motor controller with encoder</description>
            <field type="uint8_t" name="motor_id">Motor ID (1-255)</field>
            <field type="uint8_t" name="control_mode">Current control mode (0=PWM, 1=Speed, 2=Position, 3=Disabled)</field>
            <field type="uint8_t" name="status">Motor status (0=OK, 1=ERROR, 2=TIMEOUT, 3=NOT_INITIALIZED, 4=LIMIT_REACHED)</field>
            <field type="float" name="position_rad">Current position in radians</field>
            <field type="float" name="speed_rad_s">Current speed in rad/s</field>
            <field type="float" name="duty_cycle">Current PWM duty cycle (-1.0 to 1.0)</field>
            <field type="float" name="position_error_rad">Position error in radians (only valid in position mode)</field>
            <field type="float" name="target_value">Current target value (depends on control mode)</field>
            <field type="uint32_t" name="timestamp_ms">Timestamp in milliseconds</field>
        </message>

        <!-- Generic Motor Command Message (for RS485 and unified control) -->
        <message id="12004" name="MOTOR_COMMAND">
            <description>Generic direct motor control command for extended motor IDs and RS485 motors</description>
            <field type="uint8_t" name="motor_id">Motor ID (1-255)</field>
            <field type="uint8_t" name="control_mode">Control mode (0=position, 1=velocity, 2=current, 3=duty_cycle)</field>
            <field type="float" name="target_value">Target value (units depend on control_mode)</field>
            <field type="uint8_t" name="enable">Enable motor (0=disable, 1=enable)</field>
        </message>

        <!-- RS485 Motor Status Message -->
        <message id="12005" name="RS485_MOTOR_STATUS">
            <description>Status feedback from RS485 motor (Ikeya MD protocol)</description>
            <field type="uint8_t" name="motor_id">Motor ID (30-49 for RS485 motors)</field>
            <field type="uint8_t" name="device_id">RS485 board device ID (DIP switch setting)</field>
            <field type="uint8_t" name="motor_index">Motor index on board (0-2 for 3-motor boards)</field>
            <field type="uint8_t" name="control_mode">Control mode (0=position, 1=velocity)</field>
            <field type="uint8_t" name="status">Motor status (0=OK, 1=ERROR, 2=TIMEOUT, 3=NOT_INITIALIZED)</field>
            <field type="uint8_t" name="error_code">RS485 protocol error code (0=no error)</field>
            <field type="float" name="current_position_rotations">Current position in rotations</field>
            <field type="float" name="current_velocity_rps">Current velocity in revolutions per second</field>
            <field type="float" name="target_velocity_rps">Target velocity in revolutions per second</field>
            <field type="float" name="acceleration_rps2">Acceleration setting in rev/s^2</field>
            <field type="uint32_t" name="timestamp_ms">Timestamp in milliseconds</field>
        </message>
    </messages>
</mavlink>