/**
 * @file mavlink_generated_config.h
 * @brief Auto-generated MAVLink device configuration
 *
 * Generated from: {{ config_file }}
 * Platform: {{ platform.type | upper }}
 * Generated: {{ generated_timestamp }}
 * Generator Version: {{ generator_version }}
 *
 * DO NOT EDIT THIS FILE MANUALLY!
 * Any changes will be overwritten on next generation.
 */

#ifndef MAVLINK_GENERATED_CONFIG_H
#define MAVLINK_GENERATED_CONFIG_H

#ifdef __cplusplus
extern "C" {
#endif

#include <stdint.h>
#include <stdbool.h>

/* ========================================================================== */
/*  PLATFORM CONFIGURATION                                                    */
/* ========================================================================== */

#define MAVLINK_GEN_PLATFORM_{{ platform.type | upper }}
#define MAVLINK_GEN_MCU_MODEL "{{ platform.mcu.model }}"
#define MAVLINK_GEN_MCU_CLOCK_MHZ {{ platform.mcu.clock_mhz }}
{% if platform.mcu.voltage_v %}
#define MAVLINK_GEN_MCU_VOLTAGE_V {{ platform.mcu.voltage_v | format_float }}
{% endif %}
{% if platform.mcu.memory %}
#define MAVLINK_GEN_MCU_FLASH_KB {{ platform.mcu.memory.flash_kb }}
#define MAVLINK_GEN_MCU_RAM_KB {{ platform.mcu.memory.ram_kb }}
{% endif %}

/* ========================================================================== */
/*  MAVLINK CONFIGURATION                                                     */
/* ========================================================================== */

#define MAVLINK_GEN_SYSTEM_ID {{ mavlink.system_id }}
#define MAVLINK_GEN_COMPONENT_ID {{ mavlink.component_id }}
#define MAVLINK_GEN_AUTOPILOT_TYPE {{ mavlink.autopilot_type }}

/* Transport: {{ mavlink.transport.type | upper }} */
#define MAVLINK_GEN_TRANSPORT_{{ mavlink.transport.type | upper }}

{% if mavlink.transport.type == 'uart' %}
#define MAVLINK_GEN_UART_PORT "{{ mavlink.transport.uart.port }}"
#define MAVLINK_GEN_UART_BAUDRATE {{ mavlink.transport.uart.baudrate }}
#define MAVLINK_GEN_UART_RX_BUFFER_SIZE {{ mavlink.transport.uart.rx_buffer_size | default(512) }}
#define MAVLINK_GEN_UART_TX_BUFFER_SIZE {{ mavlink.transport.uart.tx_buffer_size | default(512) }}

{% elif mavlink.transport.type == 'udp' %}
#define MAVLINK_GEN_UDP_LOCAL_IP "{{ mavlink.transport.udp.local_ip }}"
#define MAVLINK_GEN_UDP_LOCAL_PORT {{ mavlink.transport.udp.local_port }}
#define MAVLINK_GEN_UDP_REMOTE_IP "{{ mavlink.transport.udp.remote_ip }}"
#define MAVLINK_GEN_UDP_REMOTE_PORT {{ mavlink.transport.udp.remote_port }}

{% elif mavlink.transport.type == 'tcp' %}
#define MAVLINK_GEN_TCP_HOST "{{ mavlink.transport.tcp.host }}"
#define MAVLINK_GEN_TCP_PORT {{ mavlink.transport.tcp.port }}

{% elif mavlink.transport.type == 'can' %}
#define MAVLINK_GEN_CAN_INTERFACE "{{ mavlink.transport.can.interface }}"
#define MAVLINK_GEN_CAN_BITRATE {{ mavlink.transport.can.bitrate }}
{% endif %}

/* ========================================================================== */
/*  DEVICE COUNTS                                                             */
/* ========================================================================== */

#define MAVLINK_GEN_DEVICE_COUNT {{ device_count }}
#define MAVLINK_GEN_SERVO_COUNT {{ servo_count }}
#define MAVLINK_GEN_DC_MOTOR_COUNT {{ dc_motor_count }}
#define MAVLINK_GEN_BLDC_MOTOR_COUNT {{ bldc_motor_count }}
#define MAVLINK_GEN_STEPPER_COUNT {{ stepper_count }}
#define MAVLINK_GEN_ROBOMASTER_COUNT {{ robomaster_count }}
#define MAVLINK_GEN_RS485_MOTOR_COUNT {{ rs485_motor_count }}
#define MAVLINK_GEN_ENCODER_COUNT {{ encoder_count }}
#define MAVLINK_GEN_IMU_COUNT {{ imu_count }}
#define MAVLINK_GEN_GPS_COUNT {{ gps_count }}
#define MAVLINK_GEN_ANALOG_SENSOR_COUNT {{ analog_sensor_count }}
#define MAVLINK_GEN_DIGITAL_IO_COUNT {{ digital_io_count }}

/* ========================================================================== */
/*  DEVICE DEFINITIONS                                                        */
/* ========================================================================== */

{% for device in devices %}
/* Device {{ loop.index }}: {{ device.name }} (ID: {{ device.id }}, Type: {{ device.type }}) */
#define MAVLINK_GEN_DEVICE_{{ device.name | to_c_identifier | to_upper }}_ID {{ device.id }}
#define MAVLINK_GEN_DEVICE_{{ device.name | to_c_identifier | to_upper }}_TYPE_{{ device.type | to_upper }}
{% if device.hardware.timer %}
#define MAVLINK_GEN_DEVICE_{{ device.name | to_c_identifier | to_upper }}_TIMER {{ device.hardware.timer }}
#define MAVLINK_GEN_DEVICE_{{ device.name | to_c_identifier | to_upper }}_CHANNEL {{ device.hardware.channel }}
{% endif %}
{% if device.hardware.can_id %}
#define MAVLINK_GEN_DEVICE_{{ device.name | to_c_identifier | to_upper }}_CAN_ID {{ device.hardware.can_id | to_hex }}
{% endif %}
{% if device.hardware.uart_port %}
#define MAVLINK_GEN_DEVICE_{{ device.name | to_c_identifier | to_upper }}_UART_PORT {{ device.hardware.uart_port }}
{% endif %}

{% endfor %}

/* ========================================================================== */
/*  SYSTEM CONFIGURATION                                                      */
/* ========================================================================== */

{% if system %}
#define MAVLINK_GEN_LOOP_FREQUENCY_HZ {{ system.loop_frequency_hz | default(100) }}
#define MAVLINK_GEN_HEARTBEAT_RATE_HZ {{ system.heartbeat_rate_hz | default(1) }}
#define MAVLINK_GEN_WATCHDOG_TIMEOUT_MS {{ system.watchdog_timeout_ms | default(1000) }}
{% if system.emergency_stop_pin %}
#define MAVLINK_GEN_EMERGENCY_STOP_PIN "{{ system.emergency_stop_pin }}"
{% endif %}
{% if system.debug_mode %}
#define MAVLINK_GEN_DEBUG_MODE 1
{% endif %}
{% else %}
#define MAVLINK_GEN_LOOP_FREQUENCY_HZ 100
#define MAVLINK_GEN_HEARTBEAT_RATE_HZ 1
#define MAVLINK_GEN_WATCHDOG_TIMEOUT_MS 1000
{% endif %}

/* ========================================================================== */
/*  SERVO CONFIGURATION                                                       */
/* ========================================================================== */

{% if servo_count > 0 %}
typedef struct {
    uint8_t id;
    const char* name;
    uint8_t timer_id;
    uint32_t channel;
    uint16_t min_pulse_us;
    uint16_t max_pulse_us;
    float min_angle;
    float max_angle;
    float neutral_angle;
} mavlink_gen_servo_config_t;

extern const mavlink_gen_servo_config_t mavlink_gen_servo_configs[MAVLINK_GEN_SERVO_COUNT];
{% endif %}

/* ========================================================================== */
/*  DC MOTOR CONFIGURATION                                                    */
/* ========================================================================== */

{% if dc_motor_count > 0 %}
typedef struct {
    uint8_t id;
    const char* name;
    uint8_t timer_id;
    uint32_t channel;
    float max_rpm;
    bool has_encoder;
    uint16_t encoder_ppr;
} mavlink_gen_dc_motor_config_t;

extern const mavlink_gen_dc_motor_config_t mavlink_gen_dc_motor_configs[MAVLINK_GEN_DC_MOTOR_COUNT];
{% endif %}

/* ========================================================================== */
/*  ROBOMASTER MOTOR CONFIGURATION                                            */
/* ========================================================================== */

{% if robomaster_count > 0 %}
typedef enum {
    ROBOMASTER_MOTOR_TYPE_M3508 = 0,
    ROBOMASTER_MOTOR_TYPE_M2006 = 1,
    ROBOMASTER_MOTOR_TYPE_GM6020 = 2,
} robomaster_motor_type_t;

typedef struct {
    uint8_t id;
    const char* name;
    uint16_t can_id;
    robomaster_motor_type_t motor_type;
    float max_rpm;
    float max_current;
} mavlink_gen_robomaster_config_t;

extern const mavlink_gen_robomaster_config_t mavlink_gen_robomaster_configs[MAVLINK_GEN_ROBOMASTER_COUNT];
{% endif %}

/* ========================================================================== */
/*  RS485 MOTOR CONFIGURATION                                                 */
/* ========================================================================== */

{% if rs485_motor_count > 0 %}
typedef enum {
    RS485_MODE_VELOCITY = 0,
    RS485_MODE_POSITION = 1,
} rs485_control_mode_t;

typedef struct {
    uint8_t id;
    const char* name;
    uint8_t uart_port;
    uint8_t rs485_device_id;
    rs485_control_mode_t control_mode;
    float max_rps;
} mavlink_gen_rs485_config_t;

extern const mavlink_gen_rs485_config_t mavlink_gen_rs485_configs[MAVLINK_GEN_RS485_MOTOR_COUNT];
{% endif %}

/* ========================================================================== */
/*  SENSOR CONFIGURATION                                                      */
/* ========================================================================== */

{% if imu_count > 0 %}
typedef struct {
    uint8_t id;
    const char* name;
    const char* sensor_type;
    uint8_t i2c_address;
    uint16_t sample_rate_hz;
} mavlink_gen_imu_config_t;

extern const mavlink_gen_imu_config_t mavlink_gen_imu_configs[MAVLINK_GEN_IMU_COUNT];
{% endif %}

{% if gps_count > 0 %}
typedef struct {
    uint8_t id;
    const char* name;
    const char* module_type;
    const char* uart_port;
    uint32_t baudrate;
} mavlink_gen_gps_config_t;

extern const mavlink_gen_gps_config_t mavlink_gen_gps_configs[MAVLINK_GEN_GPS_COUNT];
{% endif %}

{% if analog_sensor_count > 0 %}
typedef enum {
    ANALOG_SENSOR_VOLTAGE = 0,
    ANALOG_SENSOR_CURRENT = 1,
    ANALOG_SENSOR_TEMPERATURE = 2,
    ANALOG_SENSOR_PRESSURE = 3,
    ANALOG_SENSOR_DISTANCE = 4,
} analog_sensor_type_t;

typedef struct {
    uint8_t id;
    const char* name;
    analog_sensor_type_t sensor_type;
    const char* adc_channel;
    float scale_factor;
    float offset;
} mavlink_gen_analog_sensor_config_t;

extern const mavlink_gen_analog_sensor_config_t mavlink_gen_analog_sensor_configs[MAVLINK_GEN_ANALOG_SENSOR_COUNT];
{% endif %}

/* ========================================================================== */
/*  FUNCTION PROTOTYPES                                                       */
/* ========================================================================== */

/**
 * @brief Initialize all devices from generated configuration
 * @return 0 on success, negative on error
 */
int mavlink_gen_init_all_devices(void);

/**
 * @brief Update all devices (call in main loop)
 * @return 0 on success, negative on error
 */
int mavlink_gen_update_all_devices(void);

/**
 * @brief Emergency stop all devices
 */
void mavlink_gen_emergency_stop_all(void);

/**
 * @brief Get device name by ID
 * @param device_id Device ID
 * @return Device name or NULL if not found
 */
const char* mavlink_gen_get_device_name(uint8_t device_id);

#ifdef __cplusplus
}
#endif

#endif /* MAVLINK_GENERATED_CONFIG_H */
