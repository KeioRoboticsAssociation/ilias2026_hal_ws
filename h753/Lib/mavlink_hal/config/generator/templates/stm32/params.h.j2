/**
 * @file mavlink_generated_params.h
 * @brief Auto-generated MAVLink parameter definitions
 *
 * Generated from: {{ config_file }}
 * Platform: {{ platform.type | upper }}
 * Generated: {{ generated_timestamp }}
 * Generator Version: {{ generator_version }}
 *
 * DO NOT EDIT THIS FILE MANUALLY!
 * Any changes will be overwritten on next generation.
 */

#ifndef MAVLINK_GENERATED_PARAMS_H
#define MAVLINK_GENERATED_PARAMS_H

#ifdef __cplusplus
extern "C" {
#endif

#include <stdint.h>

/* ========================================================================== */
/*  PARAMETER DEFINITIONS                                                     */
/* ========================================================================== */

typedef struct {
    const char* name;           /* Parameter name (max 16 chars for MAVLink) */
    float current_value;        /* Current value */
    float default_value;        /* Default value */
    float min_value;            /* Minimum allowed value */
    float max_value;            /* Maximum allowed value */
    uint8_t device_id;          /* Associated device ID (0 for system params) */
    const char* description;    /* Human-readable description */
} mavlink_gen_param_def_t;

/* Parameter count */
#define MAVLINK_GEN_PARAM_COUNT {{ (robomaster_count * 6) + (dc_motor_count * 6) + (system.params | length if system.params else 0) }}

/* Parameter definitions array */
extern mavlink_gen_param_def_t mavlink_gen_param_defs[MAVLINK_GEN_PARAM_COUNT];

/* ========================================================================== */
/*  PARAMETER INDICES                                                         */
/* ========================================================================== */

{% set param_index = namespace(value=0) %}
{% for device in devices_by_type.robomaster %}
#define PARAM_IDX_RM_{{ device.id }}_SPD_KP {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}
#define PARAM_IDX_RM_{{ device.id }}_SPD_KI {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}
#define PARAM_IDX_RM_{{ device.id }}_SPD_KD {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}
#define PARAM_IDX_RM_{{ device.id }}_ANG_KP {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}
#define PARAM_IDX_RM_{{ device.id }}_ANG_KI {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}
#define PARAM_IDX_RM_{{ device.id }}_ANG_KD {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}

{% endfor %}
{% for device in devices_by_type.dc_motor %}
#define PARAM_IDX_DC_{{ device.id }}_SPD_KP {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}
#define PARAM_IDX_DC_{{ device.id }}_SPD_KI {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}
#define PARAM_IDX_DC_{{ device.id }}_SPD_KD {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}
#define PARAM_IDX_DC_{{ device.id }}_POS_KP {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}
#define PARAM_IDX_DC_{{ device.id }}_POS_KI {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}
#define PARAM_IDX_DC_{{ device.id }}_POS_KD {{ param_index.value }}
{% set param_index.value = param_index.value + 1 %}

{% endfor %}

/* ========================================================================== */
/*  PARAMETER INITIALIZATION                                                  */
/* ========================================================================== */

/**
 * @brief Initialize parameter system with default values
 */
void mavlink_gen_params_init(void);

/**
 * @brief Apply parameter to device
 * @param param Parameter definition
 */
void mavlink_gen_apply_parameter(const mavlink_gen_param_def_t* param);

/**
 * @brief Get parameter by name
 * @param name Parameter name
 * @return Parameter definition or NULL if not found
 */
const mavlink_gen_param_def_t* mavlink_gen_get_param_by_name(const char* name);

/**
 * @brief Get parameter by index
 * @param index Parameter index (0 to MAVLINK_GEN_PARAM_COUNT-1)
 * @return Parameter definition or NULL if invalid index
 */
const mavlink_gen_param_def_t* mavlink_gen_get_param_by_index(int index);

#ifdef __cplusplus
}
#endif

#endif /* MAVLINK_GENERATED_PARAMS_H */

/* ========================================================================== */
/*  PARAMETER DATA (Implementation)                                           */
/* ========================================================================== */

#ifdef MAVLINK_GENERATED_PARAMS_IMPLEMENTATION

#include <string.h>

mavlink_gen_param_def_t mavlink_gen_param_defs[MAVLINK_GEN_PARAM_COUNT] = {
{% set param_index = namespace(value=0) %}
{% for device in devices_by_type.robomaster %}
{% if device.config.robomaster.pid_speed %}
    /* RoboMaster motor {{ device.id }}: {{ device.name }} - Speed PID */
    {
        .name = "RM_{{ device.id }}_SPD_KP",
        .current_value = {{ device.config.robomaster.pid_speed.kp | default(0.0) | format_float }},
        .default_value = {{ device.config.robomaster.pid_speed.kp | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 100.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} speed Kp"
    },
    {
        .name = "RM_{{ device.id }}_SPD_KI",
        .current_value = {{ device.config.robomaster.pid_speed.ki | default(0.0) | format_float }},
        .default_value = {{ device.config.robomaster.pid_speed.ki | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} speed Ki"
    },
    {
        .name = "RM_{{ device.id }}_SPD_KD",
        .current_value = {{ device.config.robomaster.pid_speed.kd | default(0.0) | format_float }},
        .default_value = {{ device.config.robomaster.pid_speed.kd | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} speed Kd"
    },
{% endif %}
{% if device.config.robomaster.pid_angle %}
    /* RoboMaster motor {{ device.id }}: {{ device.name }} - Angle PID */
    {
        .name = "RM_{{ device.id }}_ANG_KP",
        .current_value = {{ device.config.robomaster.pid_angle.kp | default(0.0) | format_float }},
        .default_value = {{ device.config.robomaster.pid_angle.kp | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} angle Kp"
    },
    {
        .name = "RM_{{ device.id }}_ANG_KI",
        .current_value = {{ device.config.robomaster.pid_angle.ki | default(0.0) | format_float }},
        .default_value = {{ device.config.robomaster.pid_angle.ki | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} angle Ki"
    },
    {
        .name = "RM_{{ device.id }}_ANG_KD",
        .current_value = {{ device.config.robomaster.pid_angle.kd | default(0.0) | format_float }},
        .default_value = {{ device.config.robomaster.pid_angle.kd | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} angle Kd"
    },
{% endif %}
{% endfor %}

{% for device in devices_by_type.dc_motor %}
{% if device.config.dc_motor.pid_speed %}
    /* DC motor {{ device.id }}: {{ device.name }} - Speed PID */
    {
        .name = "DC_{{ device.id }}_SPD_KP",
        .current_value = {{ device.config.dc_motor.pid_speed.kp | default(0.0) | format_float }},
        .default_value = {{ device.config.dc_motor.pid_speed.kp | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} speed Kp"
    },
    {
        .name = "DC_{{ device.id }}_SPD_KI",
        .current_value = {{ device.config.dc_motor.pid_speed.ki | default(0.0) | format_float }},
        .default_value = {{ device.config.dc_motor.pid_speed.ki | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} speed Ki"
    },
    {
        .name = "DC_{{ device.id }}_SPD_KD",
        .current_value = {{ device.config.dc_motor.pid_speed.kd | default(0.0) | format_float }},
        .default_value = {{ device.config.dc_motor.pid_speed.kd | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} speed Kd"
    },
{% endif %}
{% if device.config.dc_motor.pid_position %}
    /* DC motor {{ device.id }}: {{ device.name }} - Position PID */
    {
        .name = "DC_{{ device.id }}_POS_KP",
        .current_value = {{ device.config.dc_motor.pid_position.kp | default(0.0) | format_float }},
        .default_value = {{ device.config.dc_motor.pid_position.kp | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} position Kp"
    },
    {
        .name = "DC_{{ device.id }}_POS_KI",
        .current_value = {{ device.config.dc_motor.pid_position.ki | default(0.0) | format_float }},
        .default_value = {{ device.config.dc_motor.pid_position.ki | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} position Ki"
    },
    {
        .name = "DC_{{ device.id }}_POS_KD",
        .current_value = {{ device.config.dc_motor.pid_position.kd | default(0.0) | format_float }},
        .default_value = {{ device.config.dc_motor.pid_position.kd | default(0.0) | format_float }},
        .min_value = 0.0f,
        .max_value = 10.0f,
        .device_id = {{ device.id }},
        .description = "{{ device.name }} position Kd"
    },
{% endif %}
{% endfor %}
};

void mavlink_gen_params_init(void) {
    /* Parameters are already initialized with default values */
    /* Additional initialization can be added here if needed */
}

void mavlink_gen_apply_parameter(const mavlink_gen_param_def_t* param) {
    /* Apply parameter to device based on name */
    /* This is implementation-specific and should be customized */
    /* Example: Update PID controller gains in motor controllers */
}

const mavlink_gen_param_def_t* mavlink_gen_get_param_by_name(const char* name) {
    for (int i = 0; i < MAVLINK_GEN_PARAM_COUNT; i++) {
        if (strncmp(mavlink_gen_param_defs[i].name, name, 16) == 0) {
            return &mavlink_gen_param_defs[i];
        }
    }
    return NULL;
}

const mavlink_gen_param_def_t* mavlink_gen_get_param_by_index(int index) {
    if (index >= 0 && index < MAVLINK_GEN_PARAM_COUNT) {
        return &mavlink_gen_param_defs[index];
    }
    return NULL;
}

#endif /* MAVLINK_GENERATED_PARAMS_IMPLEMENTATION */
